<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pro Task Manager - Pi Login</title>
  <script src="js/pi-sdk.js"></script>
</head>
<body>
  <h1>Pro Task Manager - Pi Login Test</h1>

  <button id="loginBtn">Login with Pi</button>

  <div id="userInfo" style="margin-top:20px; font-weight:bold;"></div>

  <script>
    if (!window.Pi) {
      document.getElementById('userInfo').innerText = "Pi SDK لم يتم تحميله!";
    } else {
      Pi.init({ version: "2.0" });

      document.getElementById('loginBtn').addEventListener('click', async () => {
        try {
          const user = await Pi.authenticate(['username']);
          console.log(user);
          // بعض النسخ القديمة قد تعيد user.user.username
          const username = user.username || user.user?.username;
          document.getElementById('userInfo').innerText = 
            `تم تسجيل الدخول: ${username}`;
        } catch (err) {
          console.error(err);
          document.getElementById('userInfo').innerText =
            "حدث خطأ أثناء تسجيل الدخول: " + err.message;
        }
      });
    }
  </script>
</body>
</html>
