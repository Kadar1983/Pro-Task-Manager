!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pro Task Manager</title>
  <link rel="stylesheet" href="css/style.css">
  <script src="js/pi-sdk.js"></script>
</head>
<body>
  <header>
    <h1>Pro Task Manager</h1>
    <p>Login with Pi to access your tasks and see your app wallet</p>
  </header>

  <main>
    <button id="loginBtn">Login with Pi</button>
    <div id="userInfo"></div>

    <section id="tasks">
      <!-- سيتم إضافة المهام بعد تسجيل الدخول -->
    </section>

    <div id="walletInfo" style="margin-top:20px; font-weight:bold;"></div>

    <button id="payBtn" style="display:none;">اختبار الدفع التجريبي</button>
    <div id="paymentInfo"></div>
  </main>

  <footer>
    <p>© 2025 Pro Task Manager</p>
  </footer>

  <script>
    const loginBtn = document.getElementById('loginBtn');
    const payBtn = document.getElementById('payBtn');
    const userInfo = document.getElementById('userInfo');
    const paymentInfo = document.getElementById('paymentInfo');
    const tasksSection = document.getElementById('tasks');
    const walletInfo = document.getElementById('walletInfo');

    // ضع هنا عنوان محفظتك العامة الخاصة بالتطبيق
    const appWalletAddress = "GAYKTZ6VFJTU3W5PCWVVMEIRM43N3BYPS3SYKIG3WJS2A23H5BQQJLTS";

    if (!window.Pi) {
      userInfo.innerText = "Pi SDK لم يتم تحميله!";
    } else {
      Pi.init({ version: "2.0" });

      loginBtn.addEventListener('click', async () => {
        try {
          const user = await Pi.authenticate(['username']);
          const username = user.username || user.user?.username;
          userInfo.innerText = `تم تسجيل الدخول: ${username}`;

          // عرض المهام
          tasksSection.innerHTML = `
            <h2>مرحبا ${username}</h2>
            <ul>
              <li>✅ إكمال مهمة اليوم</li>
              <li>✅ مراجعة المهام القادمة</li>
              <li>✅ تحديث حالة المشاريع</li>
            </ul>
          `;

          // عرض عنوان المحفظة الخاص بالتطبيق
          walletInfo.innerText = `عنوان محفظة التطبيق: ${appWalletAddress}`;

          // اظهار زر الدفع التجريبي (سيعمل لاحقًا عند On-Ramp)
          payBtn.style.display = "inline-block";

        } catch (err) {
          console.error(err);
          userInfo.innerText = "حدث خطأ أثناء تسجيل الدخول: " + err.message;
        }
      });

      payBtn.addEventListener('click', async () => {
        paymentInfo.innerText = "الدفع التجريبي متاح فقط عند ربط On-Ramp وProduction URL.";
      });
    }
  </script>
</body>
</html>
