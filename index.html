!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pro Task Manager</title>
  <link rel="stylesheet" href="css/style.css">
  <script src="js/pi-sdk.js"></script>
</head>
<body>
  <header>
    <h1>Pro Task Manager</h1>
    <p>Login with Pi to access your tasks and make a test payment</p>
  </header>

  <main>
    <button id="loginBtn">Login with Pi</button>
    <div id="userInfo"></div>

    <section id="tasks">
      <!-- سيتم إضافة المهام بعد تسجيل الدخول -->
    </section>

    <button id="payBtn" style="display:none;">اختبار الدفع التجريبي</button>
    <div id="paymentInfo"></div>
  </main>

  <footer>
    <p>© 2025 Pro Task Manager</p>
  </footer>

  <script>
    const loginBtn = document.getElementById('loginBtn');
    const payBtn = document.getElementById('payBtn');
    const userInfo = document.getElementById('userInfo');
    const paymentInfo = document.getElementById('paymentInfo');
    const tasksSection = document.getElementById('tasks');

    if (!window.Pi) {
      userInfo.innerText = "Pi SDK لم يتم تحميله!";
    } else {
      Pi.init({ version: "2.0" });

      loginBtn.addEventListener('click', async () => {
        try {
          const user = await Pi.authenticate(['username']);
          const username = user.username || user.user?.username;
          userInfo.innerText = `تم تسجيل الدخول: ${username}`;

          // عرض المهام بعد تسجيل الدخول
          tasksSection.innerHTML = `
            <h2>مرحبا ${username}</h2>
            <ul>
              <li>✅ إكمال مهمة اليوم</li>
              <li>✅ مراجعة المهام القادمة</li>
              <li>✅ تحديث حالة المشاريع</li>
            </ul>
          `;

          // اظهار زر الدفع التجريبي
          payBtn.style.display = "inline-block";

        } catch (err) {
          console.error(err);
          userInfo.innerText = "حدث خطأ أثناء تسجيل الدخول: " + err.message;
        }
      });

      payBtn.addEventListener('click', async () => {
        try {
          // عملية دفع تجريبية
          const tx = await Pi.makePayment({
            amount: "0.1", // مثال: 0.1 Pi
            memo: "اختبار الدفع التجريبي",
          });
          console.log(tx);
          paymentInfo.innerText = `تم الدفع بنجاح! TxID: ${tx.id || tx.transaction_id}`;
        } catch (err) {
          console.error(err);
          paymentInfo.innerText = "حدث خطأ أثناء الدفع: " + err.message;
        }
      });
    }
  </script>
</body>
</html>
